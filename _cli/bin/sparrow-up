#!/bin/bash
# Description: Build containers, start, detach, and follow logs.

cd "$SPARROW_PATH"

sparrow compose up --build --no-start $@
# Follow logs for running container(s)
exit_code=$?
if (( $exit_code == 0 )); then
  echo "$(tput bold)Containers built successfully! Following logs.$(tput sgr0)"
  sparrow compose start $@
  # Reload nginx just in case that container was not rebuilt/restarted
  sparrow compose exec gateway nginx -s reload
  sparrow compose logs -f --tail 0

else
  echo "$(tput bold)One or more containers did not build properly, aborting.$(tput sgr0)"
  # Forward exit code to workers
  exit $exit_code
fi
